{"version":3,"file":"bootstrapURLs.js","sourceRoot":"","sources":["../../../src/lens-core-module/loader/bootstrapURLs.ts"],"names":[],"mappings":";AACA,OAAO,EAAE,uBAAuB,EAAE,MAAM,qCAAqC,CAAC;AAC9E,OAAO,EAAE,eAAe,EAAE,MAAM,6BAA6B,CAAC;AAE9D,MAAM,UAAU,GAAG,CAAC,wBAAwB,EAAE,0BAA0B,CAAC,CAAC;AAE1E,MAAM,UAAU,cAAc,CAAC,EAAE,IAAI,EAAE,iBAAiB,EAAE,WAAW,EAAgB,EAAE,WAAmB;IAQtG,MAAM,qBAAqB,GAAG,QAAQ,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,gBAAgB,CAAC;IAC/E,IAAI,qBAAqB,IAAI,WAAW,EAAE;QACtC,OAAO,sBAAsB,CAAC;KACjC;SAAM,IAAI,IAAI,EAAE;QACb,IAAI,iBAAiB,EAAE;YACnB,OAAO,cAAc,CAAC;SACzB;aAAM;YACH,OAAO,cAAc,CAAC;SACzB;KACJ;SAAM,IAAI,iBAAiB,EAAE;QAC1B,OAAO,SAAS,CAAC;KACpB;SAAM;QACH,OAAO,SAAS,CAAC;KACpB;AACL,CAAC;AAaD,MAAM,UAAgB,wBAAwB,CAAC,gBAAyB;;QAEpE,MAAM,QAAQ,GAAG,gBAAgB,aAAhB,gBAAgB,uBAAhB,gBAAgB,CAAE,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;QAEzD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,uBAAuB,EAAE,CAAC;QACjD,IAAI,CAAC,IAAI,CAAC,SAAS;YAAE,MAAM,IAAI,CAAC,KAAK,CAAC;QAEtC,MAAM,EAAE,QAAQ,EAAE,GAAG,eAAe,EAAE,CAAC;QACvC,MAAM,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC;QACjC,MAAM,WAAW,GAAG,QAAQ,CAAC,WAAW,CAAC;QACzC,MAAM,MAAM,GAAG,cAAc,CAAC,IAAI,CAAC,YAAY,EAAE,WAAW,CAAC,CAAC;QAC9D,OAAO,UAAU,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE,EAAE;YAC5B,IAAI,QAAQ;gBAAE,OAAO,GAAG,QAAQ,IAAI,KAAK,EAAE,CAAC;YAC5C,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;YAC/D,OAAO,GAAG,MAAM,GAAG,QAAQ,IAAI,OAAO,IAAI,WAAW,IAAI,MAAM,IAAI,KAAK,GAAG,MAAM,EAAE,CAAC;QACxF,CAAC,CAAC,CAAC;IACP,CAAC;CAAA","sourcesContent":["import type { WasmFeatures } from \"../../platform/platformCapabilities\";\nimport { getPlatformCapabilities } from \"../../platform/platformCapabilities\";\nimport { getPlatformInfo } from \"../../platform/platformInfo\";\n\nconst wasmAssets = [\"LensCoreWebAssembly.js\", \"LensCoreWebAssembly.wasm\"];\n\nexport function getBuildFlavor({ simd, exceptionHandling, relaxedSimd }: WasmFeatures, buildNumber: string) {\n    // Starting from build {!!TODO: UPDATE WITH ACTUAL NUMBER!!}, LensCore now includes relaxed builds.\n    // We need to check for this because we allow customization of Camera Kit\n    // with any LensCore builds, which may not include a relaxed build.\n    // TODO: https://jira.sc-corp.net/browse/CAMKIT-6390\n    // Due to bug https://jira.sc-corp.net/browse/CAMKIT-6455, we decided to rollback emscripten,\n    // which allowed us to have relaxed builds. Once the bug is addressed and relaxed builds are available\n    // update the check below with actual LensCore build number.\n    const relaxedBuildAvailable = parseInt(buildNumber) >= Number.MAX_SAFE_INTEGER;\n    if (relaxedBuildAvailable && relaxedSimd) {\n        return \"rel-relaxed-simd-neh\";\n    } else if (simd) {\n        if (exceptionHandling) {\n            return \"rel-simd-neh\";\n        } else {\n            return \"release-simd\";\n        }\n    } else if (exceptionHandling) {\n        return \"rel-neh\";\n    } else {\n        return \"release\";\n    }\n}\n\n/**\n * Returns a list of URLs for resources which will be fetched during {@link bootstrapCameraKit}.\n *\n * When CameraKit is used on a website, these URLs must be reachable in order for CameraKit to be successfully\n * bootstrapped.\n *\n * @param endpointOverride Optional endpoint override to load the assets from.\n * @returns An array of asset URLs.\n *\n * @category Bootstrapping and Configuration\n */\nexport async function getRequiredBootstrapURLs(endpointOverride?: string): Promise<string[]> {\n    // If we have an endpoint override, remove trailing `/` so we can construct a valid URL.\n    const endpoint = endpointOverride?.replace(/[\\/]+$/, \"\");\n\n    const { wasm } = await getPlatformCapabilities();\n    if (!wasm.supported) throw wasm.error;\n\n    const { lensCore } = getPlatformInfo();\n    const version = lensCore.version;\n    const buildNumber = lensCore.buildNumber;\n    const flavor = getBuildFlavor(wasm.wasmFeatures, buildNumber);\n    return wasmAssets.map((asset) => {\n        if (endpoint) return `${endpoint}/${asset}`;\n        const { origin, pathname, search } = new URL(lensCore.baseUrl);\n        return `${origin}${pathname}/${version}/${buildNumber}/${flavor}/${asset}${search}`;\n    });\n}\n"]}