"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PartialContainer = void 0;
const entries_1 = require("./entries");
const memoize_1 = require("./memoize");
const Injectable_1 = require("./Injectable");
class PartialContainer {
    injectables;
    constructor(injectables) {
        this.injectables = injectables;
    }
    provides(fn) {
        return new PartialContainer({ ...this.injectables, [fn.token]: fn });
    }
    providesValue = (token, value) => this.provides((0, Injectable_1.Injectable)(token, [], () => value));
    providesClass = (token, cls) => this.provides((0, Injectable_1.ClassInjectable)(token, cls));
    getFactories(parent) {
        let factories = undefined;
        return (factories = Object.fromEntries((0, entries_1.entries)(this.injectables).map(([token, fn]) => [
            token,
            (0, memoize_1.memoize)(parent, () => fn(...fn.dependencies.map((t) => {
                return t === token
                    ? parent.get(t)
                    : factories[t]
                        ? factories[t]()
                        : parent.get(t);
            }))),
        ])));
    }
    getTokens() {
        return Object.keys(this.injectables);
    }
}
exports.PartialContainer = PartialContainer;
//# sourceMappingURL=PartialContainer.js.map